const { Client } = require('pg');

const client = new Client({
    connectionString: "postgresql://postgres:Supabzk003!@db.hkbeqdhzpkvewsvhqifa.supabase.co:5432/postgres"
});

const cities = [
    "תל אביב -יפו", "ירושלים", "חיפה", "ראשון לציון", "פתח תקווה", "אשדוד", "נתניה", "באר שבע", "בני ברק", "חולון", "רמת גן", "רחובות", "אשקלון", "בת ים", "בית שמש", "כפר סבא", "הרצליה", "חדרה", "מודיעין-מכבים-רעות", "רעננה", "מודיעין עילית", "רמלה", "רהט", "הוד השרון", "גבעתיים", "קרית אתא", "נהריה", "קרית גת", "עכו", "אילת", "כרמיאל", "נוף הגליל", "קרית מוצקין", "טבריה", "קרית ים", "קרית ביאליק", "רמת השרון", "לוד", "נצרת", "קרית אונו", "ראש העין", "נס ציונה", "נהרייה", "קרית שמונה", "נתיבות", "תל מונד", "אלעד", "מבשרת ציון", "קרית מלאכי", "צפת", "אריאל", "אור עקיבא", "קצרין", "קרית ארבע", "מעלה אדומים", "מגדל העמק", "טירת כרמל", "ערד", "יבנה", "יהוד-מונוסון", "כפר יונה", "נשר", "קרית טבעון", "שוהם", "פרדס חנה-כרכור", "גדרה", "מזכרת בתיה", "בני עייש", "כוכב יאיר", "גני תקווה", "אזור", "כפר שמריהו", "רמת ישי", "כוכב השחר", "אפרת", "כפר חב''ד", "יפיע", "אכסאל", "עין מאהל", "בועיינה-נוג'ידאת", "זמר", "ביר אל-מכסור", "כעביה-טבאש-חג'אג'רה", "בסמת טבעון", "זרזיר", "שיבלי - אום אל-גנם", "כפר כמא", "כפר כנא", "טורעאן", "דיר חנא", "עראבה", "סח'נין", "מג'ד אל-כרום", "בענה", "דייר אל-אסד", "נחף", "ראמה", "סאג'ור", "בית ג'ן", "חורפיש", "פקיעין (בוקייעה)", "מעלות-תרשיחא", "שלומי", "מעיליא", "פסוטה", "כפר יאסיף", "אבו סנאן", "מזרעה", "ג'דיידה-מכר", "ירכא", "ג'וליס", "יאנוח-ג'ת", "כיסרא-סמיע", "פקיעין החדשה", "חוסנייה", "ראס אל-עין", "עראמשה", "שייח' דנון", "ואדי אל-חמאם", "רומאנה", "עוזייר", "סולאם", "נעורה", "תמרה (יזרעאל)", "נין", "דבוריה", "אום אל-פחם", "באקה אל-גרביה", "ג'ת", "קלנסווה", "טייבה", "טירה", "כפר קאסם", "כפר ברא", "ג'לג'וליה", "בסמ''ה", "מעלה עירון", "זלפה", "סאלם", "מוסמוס", "משירפה", "ערערה", "ערערה-בנגב", "רהט", "לקיה", "חורה", "כסייפה", "ערערה בנגב", "שגב-שלום", "תל שבע", "סעוה", "מולדה", "אבו תלול", "אל סייד", "דרג'את", "כחלה", "אום בטין", "ביר הדאג'", "תראבין א-צאנע", "דריג'את", "אבו קורינאת", "קצר א-סר", "יתיר", "שני", "ליבנה", "חירן", "כרמית", "מחנה יתיר", "אבו גוש", "עין נקובא", "עין ראפה", "קיסריה", "מעגן מיכאל", "געש", "שפיים", "נווה אפרים", "צופית", "שדה ורבורג", "משמרת", "בית ינאי", "מכמורת", "נעורים", "שדות ים", "צוקי ים", "בית חירות", "חופית", "מכמורת", "כפר ויתקין", "בית יצחק-שער חפר", "נווה איתמר", "אביחיל", "עין עירון", "גן השומרון", "ברקאי", "מענית", "להבות חביבה", "מגל", "בחן", "בת חפר", "יד חנה", "ניצני עוז", "שער אפרים", "צור יצחק", "צור נתן", "סלעית", "צור יגאל", "מתן", "ירחיב", "ניר אליהו", "בית ברל", "רמת הכובש", "אייל", "צור יצחק", "חריש"
];

const sql = `
-- 1. Ensure table structure
CREATE TABLE IF NOT EXISTS public.cities (
    id SERIAL PRIMARY KEY,
    city_he TEXT NOT NULL UNIQUE,
    city_en TEXT
);

-- 2. Clean existing (optional) or just Insert
-- Using ON CONFLICT DO NOTHING to avoid duplicates
${cities.map(c => `INSERT INTO public.cities (city_he) VALUES ('${c.replace(/'/g, "''")}') ON CONFLICT (city_he) DO NOTHING;`).join('\n')}

-- 3. Update existing records with fallback (optional)
`;

async function update() {
    try {
        await client.connect();
        console.log("Connected to Supabase Postgres.");
        await client.query(sql);
        console.log("Database populated with major Israeli cities and towns successfully!");
    } catch (err) {
        console.error("Error updating database:", err);
    } finally {
        await client.end();
    }
}

update();
